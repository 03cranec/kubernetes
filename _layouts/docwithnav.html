{% include dochead.html %}
<!-- Search box for Google Custom Search Engine -->
<div id="gcse-wrapper">
	<gcse:search></gcse:search>
</div>
<!-- Navigation menu -->
<div id="wrapper">
	{% include nav_v1.0.html %}
</div>
<!-- Content body -->
<div class="bodywrapper">
	{% include documentation.html %}
</div>
<script type="text/javascript">
	$(function() {
		/* For the current URL, find the corresponding item in navigation menu */
		function findcurnavitem(){
			var noanchorhref = window.location.href.split('#')[0];
			var navitem = $('#wrapper a[href="' + noanchorhref + '"]');
			return navitem;
		}
		/* Open the navigation menu and highlight the menu item that corresponds to the current URL */
		function syncmenutourl(){
			var curnavitem = findcurnavitem();
			curnavitem.addClass('active');
			if(curnavitem.parent().hasClass('haschild')){
				curnavitem.next('ul').slideDown('normal');
			}
			else {
				curnavitem.parent('li').parent('ul').slideDown('normal');
			}
			return;
		}
		syncmenutourl();
		/* Look for change in page state and load any changes */
		function loadonstatechange(){
		    $(window).bind('popstate', function (event) {
				var returnLocation = history.location || document.location;
				$('.menu a').removeClass('active');
				var curnavitem = findcurnavitem();
				$('#doccontent').load(returnLocation + ' #doccontent > *');
				if (curnavitem.hasClass('gentoc')) {//generate the in-page TOC (full page loads)
					window.location = returnLocation;
				}
				if(curnavitem.parents('li.haschild').length === 0 && curnavitem.parents('li').find('a.active').length === 0){ //close sub-menu
					menu_ul.filter(':visible').slideUp('normal');
				}
				syncmenutourl();
		       return;
		    });
		}
		loadonstatechange();
		/* Load only the doccontent div on click, push state so back/forward browser buttons work, and then animate nav menu */
	    var menu_ul = $('.menu > li > ul');
	    $('a').click(function(e) {
	        e.preventDefault();
			var clickedon = $(this),
				href = $(this).attr('href');
			if(href != "#") {//get the absolute url
				href = this.href;
			}
			if(this.host != location.host && href != "javascript:;") {//open external links in new tab/window
				window.open(href, '_blank');
			} else if(href != "#" && !clickedon.parents('header').is('#nav') && !clickedon.parents('div').is('#mobile-nav-container')) {//skip empty nav menu containers and any clicks in the banner and banner menu
				history.pushState(null, null, href);
				$('#doccontent').load(href + ' #doccontent > *');
				if (clickedon.hasClass('gentoc')){//generate the in-page TOC (full page loads)
					window.location = href;
				}
				$('html, body').animate({scrollTop: 0}, 500);
			} else if (href != "#"){ //open links in main menu (full page loads)
				window.location = href;
			}
			animatenav(findcurnavitem());
		    return false; // don't actually follow the link
	    });
		/* Animate navigation menu to open/close and highlight item */
		function animatenav(anhref){
			if(!anhref.hasClass('active')) {
				if(anhref.parents('li.haschild').length === 0 || anhref.parents('li').find('a.active').length === 0){
					menu_ul.filter(':visible').slideUp('normal');
				}
				$('.menu a').removeClass('active');
				anhref.addClass('active').next().stop(true,true).slideDown('normal');
			}else if(anhref.hasClass('active') && anhref.parent().hasClass('haschild')){ //close sub-menu
				anhref.removeClass('active');
				anhref.next().stop(true,true).slideUp('normal');
			}
		}
	});
</script>
{% include docfooter.html %}
